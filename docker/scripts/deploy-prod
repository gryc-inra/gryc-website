#!/bin/bash

docker pull $APP_DOCKER_IMAGE_NAME:$TRAVIS_BRANCH
docker build --cache-from=$APP_DOCKER_IMAGE_NAME:$TRAVIS_BRANCH -t $APP_DOCKER_IMAGE_NAME:$APP_PROD_DOCKER_IMAGE_TAG .
docker tag $APP_DOCKER_IMAGE_NAME:$APP_DOCKER_IMAGE_TAG $APP_DOCKER_IMAGE_NAME:$TRAVIS_BRANCH
docker push $APP_DOCKER_IMAGE_NAME:$APP_PROD_DOCKER_IMAGE_TAG
docker push $APP_DOCKER_IMAGE_NAME:$TRAVIS_BRANCH
