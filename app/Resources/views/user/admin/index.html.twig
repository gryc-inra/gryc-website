{% extends 'base.html.twig' %}

{% block metaTags %}
    <meta name="robots" content="noindex, nofollow">
{% endblock %}

{% block breadcrumb %}
    {{ parent() }}
    <li class="breadcrumb-item"><a href="{{ path('admin_index') }}">Administration</a></li>
    <li class="breadcrumb-item active">User list</li>
{% endblock %}

{% block body %}
    <form class="form-inline mb-3" id="user-search-form" method="get">
        <label class="sr-only" for="user-search-field">Name</label>
        <input type="text" class="form-control mb-2 mr-sm-2 mb-sm-0" id="user-search-field" name="q" placeholder="Search for..." autocomplete="off" value="{{ query }}">

        <button id="type-search-button" class="btn btn-secondary" type="submit">
            <span class="fa fa-search" aria-hidden="true"></span> Search
        </button>
    </form>

    {{ list.content|raw }}
{% endblock %}

{% block javascripts %}
    {{ parent() }}

    <script>
        $(document).ready(function(){
            var processing = false;
            var search = $('#user-search-field');
            var team = $('#user-team-field');

            search.keyup(function() {
                console.log('test');
                history.replaceState('', '', Routing.generate('user_index', { q: search.val(), p: 1 }));

                delay(function(){
                    $.ajax({
                        type: 'GET',
                        url: Routing.generate('user_index_ajax', { q: search.val(), p: 1 }),
                        dataType: 'html',
                        delay: 400,
                        beforeSend: function() {
                            if (processing) {
                                return false;
                            } else {
                                processing = true;
                            }
                        },
                        success: function (html) {
                            $('#user-list').replaceWith(html);
                            processing = false;
                        }
                    });
                }, 400 );
            });
        });
    </script>
{% endblock %}
